<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VoteNow ‚Äì Student Council Voting</title>
  <style>
    :root {
      --sti-gold: #D4A418;
      --sti-teal: #1B8B9E;
      --sti-dark: #2C3E50;
      --sti-gray: #6C757D;
      --sti-light: #F5F5F5;
      --sti-white: #FFFFFF;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    html, body {
      height: 100%;
      background: linear-gradient(135deg, var(--sti-light) 0%, #E8E8E8 100%);
      color: var(--sti-dark);
    }
    
    .hidden { display: none !important; }
    
    /* Login Page Styles */
    .login-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
      background: linear-gradient(135deg, var(--sti-teal) 0%, #156876 100%);
    }
    
    .login-card {
      background: var(--sti-white);
      padding: 48px 40px;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.15);
      width: 100%;
      max-width: 420px;
      text-align: center;
    }
    
    .logo {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, var(--sti-gold) 0%, #C49415 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 24px;
      font-size: 36px;
    }
    
    .login-card h2 {
      color: var(--sti-dark);
      font-size: 28px;
      margin-bottom: 8px;
      font-weight: 700;
    }
    
    .login-card .subtitle {
      color: var(--sti-gray);
      font-size: 14px;
      margin-bottom: 32px;
      line-height: 1.5;
    }
    
    .google-btn {
      background: var(--sti-white);
      border: 2px solid #E0E0E0;
      color: var(--sti-dark);
      padding: 14px 24px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      transition: all 0.3s ease;
      margin-bottom: 20px;
    }
    
    .google-btn:hover {
      background: #F8F9FA;
      border-color: var(--sti-teal);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .divider {
      margin: 28px 0;
      padding-top: 24px;
      border-top: 1px solid #E0E0E0;
    }
    
    .admin-link {
      color: var(--sti-teal);
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
      transition: color 0.2s;
    }
    
    .admin-link:hover {
      color: var(--sti-gold);
    }
    
    /* Top Header Styles */
    .top-header {
      background: var(--sti-white);
      border-bottom: 1px solid #E0E0E0;
      padding: 12px 0;
      border-radius: 12px;
      margin: 16px;
    }
    
    .top-header-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 24px;
      display: flex;
      align-items: center;
    }
    
    .header-logo {
      display: flex;
      align-items: center;
      gap: 16px;
      text-decoration: none;
    }
    
    .header-logo-img {
      height: 45px;
      width: auto;
    }
    
    .header-logo-text {
      font-size: 20px;
      font-weight: 700;
      color: var(--sti-dark);
      display: inline-block;
    }
    
    /* Main Page Styles */
    .navbar {
      background: linear-gradient(135deg, var(--sti-gold) 0%, #C49415 100%);
      padding: 16px 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .nav-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .nav-brand {
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--sti-white);
    }
    
    .nav-logo {
      width: 40px;
      height: 40px;
      background: var(--sti-white);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }
    
    .nav-brand h1 {
      font-size: 24px;
      font-weight: 700;
    }
    
    .nav-user {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .user-name {
      color: var(--sti-white);
      font-weight: 500;
      font-size: 14px;
    }
    
    .logout-btn {
      background: rgba(255,255,255,0.2);
      border: 1px solid rgba(255,255,255,0.3);
      color: var(--sti-white);
      padding: 8px 20px;
      border-radius: 6px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .logout-btn:hover {
      background: rgba(255,255,255,0.3);
      border-color: rgba(255,255,255,0.5);
    }
    
    .container {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 24px;
    }
    
    .section-header {
      margin-bottom: 32px;
      text-align: center;
    }
    
    .section-header h2 {
      color: var(--sti-dark);
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 12px;
    }
    
    .section-header p {
      color: var(--sti-gray);
      font-size: 18px;
    }
    
    .candidates-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
      gap: 32px;
      margin-bottom: 48px;
    }
    
    .candidate-card {
      background: var(--sti-white);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      border: 3px solid transparent;
    }
    
    .candidate-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 40px rgba(0,0,0,0.15);
      border-color: var(--sti-gold);
    }
    
    .candidate-photo {
      width: 100%;
      height: 280px;
      object-fit: cover;
      background: linear-gradient(135deg, var(--sti-teal) 0%, var(--sti-gold) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 80px;
      color: var(--sti-white);
    }
    
    .candidate-photo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .candidate-content {
      padding: 24px;
    }
    
    .candidate-header {
      margin-bottom: 16px;
      text-align: center;
      border-bottom: 2px solid var(--sti-light);
      padding-bottom: 16px;
    }
    
    .candidate-card h3 {
      color: var(--sti-dark);
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 6px;
    }
    
    .candidate-card .position {
      color: var(--sti-teal);
      font-size: 16px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .candidate-description {
      color: var(--sti-gray);
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 20px;
      min-height: 60px;
    }
    
    .candidate-slogan {
      background: linear-gradient(135deg, rgba(212, 164, 24, 0.1) 0%, rgba(27, 139, 158, 0.1) 100%);
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-style: italic;
      color: var(--sti-dark);
      font-weight: 500;
      text-align: center;
      border-left: 4px solid var(--sti-gold);
    }
    
    .vote-info {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 2px solid var(--sti-light);
    }
    
    .vote-count {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--sti-gray);
      font-size: 14px;
      font-weight: 600;
    }
    
    .vote-number {
      background: linear-gradient(135deg, var(--sti-teal) 0%, #156876 100%);
      color: var(--sti-white);
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 18px;
      font-weight: 700;
    }
    
    .vote-btn {
      background: linear-gradient(135deg, var(--sti-gold) 0%, #C49415 100%);
      border: none;
      color: var(--sti-white);
      padding: 12px 28px;
      border-radius: 8px;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .vote-btn:hover:not(:disabled) {
      transform: scale(1.05);
      box-shadow: 0 6px 16px rgba(212, 164, 24, 0.4);
    }
    
    .vote-btn:disabled {
      background: #CCC;
      cursor: not-allowed;
      opacity: 0.6;
    }
    
    .results-btn {
      background: var(--sti-white);
      border: 3px solid var(--sti-teal);
      color: var(--sti-teal);
      padding: 16px 40px;
      border-radius: 10px;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
      display: block;
      margin: 0 auto;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .results-btn:hover {
      background: var(--sti-teal);
      color: var(--sti-white);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(27, 139, 158, 0.3);
    }
    
    @media (max-width: 768px) {
      .candidates-grid {
        grid-template-columns: 1fr;
      }
      
      .nav-content {
        flex-direction: column;
        gap: 16px;
      }
      
      .nav-user {
        width: 100%;
        justify-content: space-between;
      }
      
      .top-header-content {
        padding: 0 16px;
      }
      
      .header-logo-text {
        font-size: 16px;
      }
      
      .section-header h2 {
        font-size: 28px;
      }
    }
  </style>
</head>
<body>
  <!-- LOGIN PAGE -->
  <div id="loginPage" class="login-wrapper">
    <!-- Top Header -->
    <header class="top-header" style="position: fixed; top: 0; left: 0; right: 0; z-index: 1000;">
      <div class="top-header-content">
        <a href="#" class="header-logo">
          <img src="https://i.imgur.com/x1SR87D.png" alt="STI Logo" class="header-logo-img">
          <span class="header-logo-text">STI Education Services Group</span>
        </a>
      </div>
    </header>
    
    <div class="login-card" style="margin-top: 80px;">
      <div class="logo">üó≥Ô∏è</div>
      <h2>VoteNow</h2>
      <p class="subtitle">Student Council Organization Voting System<br>Cast your vote for the future leaders</p>
      
      <button class="google-btn" onclick="loginWithGoogle()">
        <svg width="18" height="18" viewBox="0 0 18 18">
          <path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z"/>
          <path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.184l-2.908-2.258c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332C2.438 15.983 5.482 18 9 18z"/>
          <path fill="#FBBC05" d="M3.964 10.707c-.18-.54-.282-1.117-.282-1.707 0-.593.102-1.17.282-1.709V4.958H.957C.347 6.173 0 7.548 0 9c0 1.452.348 2.827.957 4.042l3.007-2.335z"/>
          <path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.958L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z"/>
        </svg>
        Sign in with Google
      </button>
      
      <div class="divider">
        <a href="/adminlogin.html" class="admin-link">‚Üê Go to Admin Panel</a>
      </div>
    </div>
  </div>

  <!-- MAIN PAGE -->
  <div id="mainPage" class="hidden">
    <nav class="navbar">
      <div class="nav-content">
        <div class="nav-brand">
          <div class="nav-logo">üó≥Ô∏è</div>
          <h1>VoteNow</h1>
        </div>
        <div class="nav-user">
          <span class="user-name" id="welcomeUser"></span>
          <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
      </div>
    </nav>
    
    <div class="container">
      <div class="section-header">
        <h2>üéì Meet Your Candidates</h2>
        <p>Learn about each candidate and cast your vote for the future of our student council</p>
      </div>
      
      <div id="candidatesList" class="candidates-grid"></div>
      
      <button class="results-btn" onclick="showResults()">üìä View Current Results</button>
    </div>
  </div>

  <script>
    let currentUser = null;
    let hasVoted = false;

    // Candidate data with photos and descriptions
    const candidateData = {
      'c1': {
        photo: 'https://via.placeholder.com/400x300/1B8B9E/FFFFFF?text=Kiel+Abalajos',
        description: 'Dedicated student leader with a vision for innovation and inclusive campus development.',
        slogan: '"Leading with integrity, serving with passion"'
      },
      'c2': {
        photo: 'https://via.placeholder.com/400x300/D4A418/FFFFFF?text=Symon+Pena',
        description: 'Committed to transparency and student welfare, bringing fresh perspectives to student governance.',
        slogan: '"Your voice, our priority"'
      },
      'c3': {
        photo: 'https://via.placeholder.com/400x300/2C3E50/FFFFFF?text=Josh+Sumido',
        description: 'Organized and detail-oriented, ensuring clear communication and efficient operations.',
        slogan: '"Documentation meets dedication"'
      },
      'c4': {
        photo: 'https://via.placeholder.com/400x300/10b981/FFFFFF?text=Gclef+Dominguez',
        description: 'Financial transparency advocate with strong analytical skills and ethical practices.',
        slogan: '"Accountability in every cent"'
      },
      'c5': {
        photo: 'https://via.placeholder.com/400x300/ef4444/FFFFFF?text=Zhyke+Dela+Cruz',
        description: 'Strategic financial planner focused on sustainable budget management for student programs.',
        slogan: '"Smart spending, bright future"'
      }
    };

    async function checkAuth() {
      try {
        const response = await fetch('/api/user');
        const data = await response.json();
        
        if (data.authenticated) {
          currentUser = data.user;
          hasVoted = data.hasVoted;
          
          if (data.isAdmin) {
            window.location.href = '/admin';
            return;
          }
          
          showMainPage();
        } else {
          showLoginPage();
        }
      } catch (error) {
        console.error('Auth check failed:', error);
        showLoginPage();
      }
    }

    function loginWithGoogle() {
      window.location.href = '/auth/google';
    }

    function logout() {
      window.location.href = '/logout';
    }

    function showLoginPage() {
      document.getElementById('loginPage').classList.remove('hidden');
      document.getElementById('mainPage').classList.add('hidden');
    }

    function showMainPage() {
      document.getElementById('loginPage').classList.add('hidden');
      document.getElementById('mainPage').classList.remove('hidden');
      document.getElementById('welcomeUser').textContent = currentUser.name || currentUser.email;
      loadCandidates();
    }

    async function loadCandidates() {
      try {
        const response = await fetch('/api/candidates');
        const data = await response.json();
        
        const list = document.getElementById('candidatesList');
        list.innerHTML = '';
        
        data.candidates.forEach(c => {
          const extraData = candidateData[c.id] || {};
          const card = document.createElement('div');
          card.className = 'candidate-card';
          card.innerHTML = `
            <div class="candidate-photo">
              <img src="${extraData.photo || ''}" alt="${c.name}" onerror="this.parentElement.innerHTML='üë§'">
            </div>
            <div class="candidate-content">
              <div class="candidate-header">
                <h3>${c.name}</h3>
                <p class="position">${c.desc}</p>
              </div>
              ${extraData.slogan ? `<div class="candidate-slogan">${extraData.slogan}</div>` : ''}
              <div class="candidate-description">
                ${extraData.description || 'Committed to serving the student body with dedication and excellence.'}
              </div>
              <div class="vote-info">
                <div class="vote-count">
                  <span>Votes:</span>
                  <span class="vote-number">${c.votes}</span>
                </div>
                <button class="vote-btn" ${hasVoted || !data.votingEnabled ? 'disabled' : ''} onclick="vote('${c.id}')">
                  ${!data.votingEnabled ? 'Closed' : hasVoted ? 'Voted' : 'Vote'}
                </button>
              </div>
            </div>
          `;
          list.appendChild(card);
        });
      } catch (error) {
        console.error('Failed to load candidates:', error);
      }
    }

    async function vote(candidateId) {
      if (hasVoted) {
        alert('You have already voted!');
        return;
      }

      try {
        const response = await fetch('/api/vote', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ candidateId })
        });

        const data = await response.json();
        
        if (response.ok) {
          hasVoted = true;
          alert('Vote recorded successfully! ‚úÖ');
          loadCandidates();
        } else {
          alert(data.error || 'Failed to record vote');
        }
      } catch (error) {
        console.error('Vote failed:', error);
        alert('Failed to record vote. Please try again.');
      }
    }

    async function showResults() {
      try {
        const response = await fetch('/api/results');
        const results = await response.json();
        
        const candidates = [
          { id: 'c1', name: 'Kiel Abalajos' },
          { id: 'c2', name: 'Symon Pena' },
          { id: 'c3', name: 'Josh Sumido' },
          { id: 'c4', name: 'Gclef dominguez' },
          { id: 'c5', name: 'Zhyke Dela Cruz' }
        ];
        
        const msg = candidates.map(c => `${c.name}: ${results[c.id]} votes`).join('\n');
        alert('üìä Current Results:\n\n' + msg);
      } catch (error) {
        console.error('Failed to load results:', error);
      }
    }

    checkAuth();
  </script>
</body>
</html>